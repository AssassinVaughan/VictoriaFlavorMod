namespace = dual_monarchy

# Dual Monarchy event
dual_monarchy.1 = {
	type = country_event

	title = dual_monarchy.1.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = dual_monarchy.1.d
				trigger = {
					NOT = { has_variable = dual_monarchy_fail }
				}
			}
			triggered_desc = {
				desc = dual_monarchy.1.d2
				trigger = {
					has_variable = dual_monarchy_fail
				}
			}
		}
	}
	flavor = dual_monarchy.1.f

	event_image = {
		video = unspecific_ruler_speaking_to_people
	}

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	duration = 3

	trigger = {
		# triggered by dual monarchy JE
	}

	immediate = {
		cu:hungarian = {
			save_scope_as = hungarian_culture
		}
	}

	option = {
		name = dual_monarchy.1.a
		trigger = {
			#NOT = { has_variable = dual_monarchy_fail }
		}
		default_option = yes
		custom_tooltip = austria_hungary_tt
		add_primary_culture = cu:hungarian
		add_loyalists = {
			culture = cu:hungarian
			value = 0.1
		}
		ig:ig_landowners = {
			remove_ideology = ideology_austrian_hegemony
			hidden_effect = {
				set_interest_group_name = ig_landowners
			}
		}
	}
	option = { # accept compromise
		name = dual_monarchy.1.b
		default_option = yes
		trigger = {
			#has_variable = dual_monarchy_fail
		}

		#Create Hungary
		custom_tooltip = {
			text = create_hungary_personal_union_tt
			if = { #Use existing hungary
				limit = {
					c:HUN ?= {
						any_scope_state = {
							any_neighbouring_state = {
								owner = ROOT
								state_region = {
									is_homeland = cu:hungarian
								}
							}
						}
					}
				}
			}
			else = { #Create Hungary
				if = {
					limit = {
						exists = s:STATE_CENTRAL_HUNGARY.region_state:AUS
					}
					s:STATE_CENTRAL_HUNGARY.region_state:AUS = {
						set_variable = former_austria
					}
					create_country = {
						tag = HUN
						origin = this
						state = s:STATE_CENTRAL_HUNGARY.region_state:AUS
					}
				}
			}
			#Give land to hungary
			every_scope_state = { 
				limit = {
					state_region = {
						is_homeland = cu:hungarian
					}
					state_region != s:STATE_ISTRIA
					state_region != s:STATE_DALMATIA
				}
				set_variable = former_austria
				set_state_owner = c:HUN
				set_state_type = incorporated
			}
			#Give more unincorporated land to hungary
			every_scope_state = { 
				limit = {
					OR = {
						state_region = s:STATE_SLAVONIA
						state_region = s:STATE_CROATIA
						state_region = s:STATE_CARPATHIAN_RUTHENIA
					}
				}
				set_variable = former_austria
				set_state_owner = c:HUN
			}
			#Make hungary a personal union
			create_diplomatic_pact = {
				country = c:HUN
				type = personal_union
			}
			
			remove_modifier = the_dual_monarchy
		}

		ig:ig_landowners = {
			remove_ideology = ideology_austrian_hegemony
			hidden_effect = {
				set_interest_group_name = ig_landowners
			}
		}
		add_radicals = {
			value = medium_radicals
			culture = cu:south_german
		}
		add_radicals = {
			value = large_radicals
			culture = cu:south_german
			pop_type = aristocrats
		}
		# lose prestige
		add_modifier = {
			name = dual_monarchy_compromise
			months = very_long_modifier_time
		}
	}
	option = { #reject compromise
		name = dual_monarchy.1.c
		trigger = {
			#has_variable = dual_monarchy_fail
		}
        

		#Create Hungary
		custom_tooltip = {
			text = create_hungary_tt
			if = { #Use existing hungary
				limit = {
					c:HUN ?= {
						any_scope_state = {
							any_neighbouring_state = {
								owner = ROOT
								state_region = {
									is_homeland = cu:hungarian
								}
							}
						}
					}
				}
			}
			else = { #Create Hungary
				if = {
					limit = {
						exists = s:STATE_CENTRAL_HUNGARY.region_state:AUS
					}
					s:STATE_CENTRAL_HUNGARY.region_state:AUS = {
						set_variable = former_austria
					}
					create_country = {
						tag = HUN
						origin = this
						state = s:STATE_CENTRAL_HUNGARY.region_state:AUS
					}
				}
			}
			#Give land to hungary
			every_scope_state = { 
				limit = {
					state_region = {
						is_homeland = cu:hungarian
					}
					state_region != s:STATE_ISTRIA
					state_region != s:STATE_DALMATIA
				}
				set_variable = former_austria
				set_state_owner = c:HUN
				set_state_type = incorporated
			}
			#Give more unincorporated land to hungary
			every_scope_state = { 
				limit = {
					OR = {
						state_region = s:STATE_SLAVONIA
						state_region = s:STATE_CROATIA
						state_region = s:STATE_CARPATHIAN_RUTHENIA
					}
				}
				set_variable = former_austria
				set_state_owner = c:HUN
			}
		}
		
		if = {
		    limit = {
				cu:hungarian = {
					culture_secession_progress = {
						target = ROOT
						value < 0.4 # Dont start the dp if it's already secessionist
					}
		  	  }
			}

		create_diplomatic_play = {
		
			target_state = s:STATE_CENTRAL_HUNGARY.region_state:HUN
			
			escalation = 45
			
			type = dp_annex_war

			add_war_goal = {
					holder = c:HUN
					type = independence
					target_state = s:STATE_AUSTRIA.region_state:AUS
			}
		}
		}

        # add radicals from discrimination
		add_radicals = {
			value = very_large_radicals
			culture = cu:hungarian
		}
	}
	option = { # Hungary Play as
		name = dual_monarchy.1.e
		trigger = {
			#has_variable = dual_monarchy_fail
		}

		custom_tooltip = {
			text = create_hungary_personal_union_tt
			if = { #Use existing hungary
				limit = {
					c:HUN ?= {
						any_scope_state = {
							any_neighbouring_state = {
								owner = ROOT
								state_region = {
									is_homeland = cu:hungarian
								}
							}
						}
					}
				}
			}
			else = { #Create Hungary
				if = {
					limit = {
						exists = s:STATE_CENTRAL_HUNGARY.region_state:AUS
					}
					s:STATE_CENTRAL_HUNGARY.region_state:AUS = {
						set_variable = former_austria
					}
					create_country = {
						tag = HUN
						origin = this
						state = s:STATE_CENTRAL_HUNGARY.region_state:AUS
					}
				}
			}
			#Give land to hungary
			every_scope_state = { 
				limit = {
					state_region = {
						is_homeland = cu:hungarian
					}
					state_region != s:STATE_ISTRIA
					state_region != s:STATE_DALMATIA
				}
				set_variable = former_austria
				set_state_owner = c:HUN
				set_state_type = incorporated
			}
			#Give more unincorporated land to hungary
			every_scope_state = { 
				limit = {
					OR = {
						state_region = s:STATE_SLAVONIA
						state_region = s:STATE_CROATIA
						state_region = s:STATE_CARPATHIAN_RUTHENIA
					}
				}
				set_variable = former_austria
				set_state_owner = c:HUN
			}
			#Make hungary a personal union
			create_diplomatic_pact = {
				country = c:HUN
				type = personal_union
			}
		}

		ig:ig_landowners = {
			remove_ideology = ideology_austrian_hegemony
			hidden_effect = {
				set_interest_group_name = ig_landowners
			}
		}
        add_radicals = {
			value = medium_radicals
			culture = cu:south_german
		}
		add_radicals = {
			value = large_radicals
			culture = cu:south_german
			pop_type = aristocrats
		}
		# lose prestige
		add_modifier = {
			name = dual_monarchy_compromise
			months = very_long_modifier_time
		}
		
		remove_modifier = the_dual_monarchy

		play_as = c:HUN
	}
}